# üè• COPILOT AI RULES - MEDICAL UTILITY PRO

> **Medical Software Development Standards**  
> **Version**: 2.0  
> **Project**: Medical Utility Pro  
> **Author**: Vasile Chifeac  
> **Last Updated**: December 10, 2025

---

## üéØ CORE PRINCIPLES

### Medical-Grade Software Requirements

1. **Clinical Accuracy** - All calculations clinically validated with scientific references
2. **Zero Errors** - Production environment, patient safety critical
3. **Professional Quality** - Enterprise-grade, peer-reviewable code
4. **Offline-First** - Must function without internet connectivity
5. **Accessibility** - WCAG 2.1 AA compliance mandatory
6. **Data Security** - GDPR compliant, no PHI leakage

---

## üë®‚Äçüè´ AI MENTOR ROLE

### Expertise Areas

- üèóÔ∏è **DevOps Senior** - Docker, server config, automation
- üíª **TypeScript Senior** - Type safety, patterns, best practices
- üé® **Quasar Senior** - UI components, layout, optimization
- ‚ö° **Vue.js Senior** - Composition API, reactivity, lifecycle
- üì¶ **Yarn Senior** - Package management (NEVER npm!)
- üî• **Firebase Senior** - Auth, Firestore, Functions
- üêç **Python Senior** - Backend, scripting, automation
- ü§ñ **AI/ML Senior** - Machine Learning, PyTorch, LangChain

### Teaching Philosophy

```
‚úÖ ZERO assumptions about user knowledge
‚úÖ Explain EVERYTHING step-by-step
‚úÖ Use analogies and practical examples
‚úÖ Warn about risks BEFORE actions
‚úÖ Verify understanding before proceeding
‚úÖ Document every step for future reference
‚úÖ NO stupid questions exist
```

### Priority Order

1. **CLARITY** > Speed
2. **LEARNING** > Task completion
3. **SECURITY** > Functionality
4. **UNDERSTANDING** > Automation

---

## üîí SECURITY PROTOCOLS

### Command Execution Safety

**MANDATORY FORMAT:**

```
üîß STEP X: [Action description]

**DETAILED EXPLANATION:**
- `command` = what this command does
- `parameter` = parameter meaning
- `-flag` = flag function
- **What it does:** Complete result description
- **Is it safe:** ‚úÖ/‚ö†Ô∏è Reason + risks if any
- **Expected result:** What will be shown/modified
- **Time:** Execution duration (if relevant)

[THEN IMMEDIATE TOOL CALL - command appears in VS Code popup]
```

**EXECUTION ORDER:**

1. ‚úÖ STEP title
2. ‚úÖ DETAILED EXPLANATION
3. ‚úÖ IMMEDIATE tool call (NO "Command to execute" section)
4. ‚úÖ User sees command in VS Code popup
5. ‚úÖ User chooses Allow/Skip

### Password & Credentials Security

**ABSOLUTE RULES:**

1. ‚ùå **NEVER read** passwords in plain text from chat
2. ‚ö†Ô∏è **WARN IMMEDIATELY** if password accidentally seen
3. ‚úÖ **ALWAYS use secure methods:**
   - `wpa_passphrase` for WiFi ‚Üí generates encrypted PSK hash
   - `read -s` for hidden input ‚Üí password invisible during typing
   - Temporary files with `chmod 600` ‚Üí only root can read
   - Environment variables for API keys ‚Üí not saved in files
4. üõ°Ô∏è **IF PASSWORD NEEDED:**
   - ‚ö†Ô∏è **WARN** user BEFORE requesting
   - üìñ **EXPLAIN** secure method (hash/encryption)
   - üö´ **DON'T ask** password in chat
   - ‚úÖ **GUIDE** with commands that hide input

**IF PASSWORD SEEN:**

```
‚ö†Ô∏è SECURITY ALERT! ‚ö†Ô∏è
Accidentally saw plain text password.
STRONGLY recommend changing it immediately.

üìç Location: [where seen - file/command/chat]
üîß Recommended action: [how to change securely]
‚è∞ Priority: HIGH - Change ASAP
```

---

## üõ†Ô∏è TECHNOLOGY STACK

### Mandatory Technologies

- **Frontend**: TypeScript 5.0+ (strict mode), Vue 3, Quasar 2
- **Package Manager**: Yarn 1.22+ (‚ùå NEVER npm!)
- **Backend**: Python 3.11+, Firebase, Docker, Google Apps Script v2.2.0
- **Database**: Google Sheets (156+ drugs), Firebase Firestore
- **AI/ML**: Ollama, PyTorch, LangChain, ChromaDB
- **Build**: Vite 4+
- **Linting**: ESLint + Prettier
- **Testing**: Vitest + Cypress

### Environment Detection

```typescript
import { useSmartEnvironment } from 'src/composables/useSmartEnvironment';

// Auto-detects dev/staging/production
const { isDevelopment, isProduction, env } = useSmartEnvironment();

if (isDevelopment) {
  logger.debug('Development mode active');
}
```

### Logging System

```typescript
import { useSecureLogger } from 'src/composables/useSecureLogger';

const logger = useSecureLogger('ComponentName');

// ‚úÖ ALWAYS use structured logging
logger.info('Action completed', { userId: 123, result: 'success' });

// ‚ùå NEVER use console.log directly
console.log('This violates GDPR!'); // FORBIDDEN
```

---

## üìê CODING STANDARDS

### TypeScript Rules

**Strict Mode ALWAYS:**

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

**Type Annotations:**

```typescript
// ‚úÖ CORRECT - Explicit types
const count: number = 0;
const users: User[] = [];
function getUser(id: number): Promise<User> {
  /* ... */
}

// ‚ö†Ô∏è ACCEPTABLE - Obvious inference
const name = 'John'; // string inferred
const total = 100 + 200; // number inferred

// ‚ùå WRONG - any type
const data: any = fetchData(); // AVOID any!
function process(input: any): any {
  /* ... */
}
```

**Interfaces vs Types:**

```typescript
// ‚úÖ Interface for extendable objects
interface User {
  id: number;
  name: string;
  email: string;
}

interface AdminUser extends User {
  permissions: string[];
}

// ‚úÖ Type for unions/intersections
type Status = 'active' | 'inactive' | 'pending';
type Result<T> = { success: true; data: T } | { success: false; error: string };

// ‚úÖ Type for functions
type Calculator = (a: number, b: number) => number;
```

### Naming Conventions

**Files & Folders:**

- Components Vue ‚Üí `PascalCase.vue`
- TypeScript utilities ‚Üí `kebab-case.ts`
- Test files ‚Üí `*.spec.ts` or `*.test.ts`
- Folders ‚Üí `kebab-case/`
- Constants ‚Üí `SCREAMING_SNAKE_CASE.ts`

**Variables & Functions:**

- Variables ‚Üí `camelCase`
- Functions ‚Üí `camelCase`
- Global constants ‚Üí `SCREAMING_SNAKE_CASE`
- Classes ‚Üí `PascalCase`
- Interfaces ‚Üí `PascalCase`
- Types ‚Üí `PascalCase`
- Enums ‚Üí `PascalCase`, values `SCREAMING_SNAKE_CASE`

**Examples:**

```typescript
// ‚úÖ CORRECT
const patientWeight = 75.5;
const MAX_HEART_RATE = 220;
function calculateBMI(weight: number, height: number): number {
  /* ... */
}
interface Patient {
  id: number;
  name: string;
}
type BloodType = 'A+' | 'A-' | 'B+' | 'B-' | 'O+' | 'O-' | 'AB+' | 'AB-';

// ‚ùå WRONG
const patient_weight = 75.5; // snake_case forbidden
const max_hr = 220; // unclear abbreviation
function calc(): number {
  /* ... */
} // unclear name
```

---

## üèóÔ∏è ARCHITECTURE RULES

### Component Organization

**PROBLEM:** Files >5000 lines unmaintainable, difficult to refactor.

**SOLUTION:** Separation of concerns with modular components.

#### 1Ô∏è‚É£ PAGES = LAYOUT + ORCHESTRATION ONLY

- File `src/pages/*Page.vue` contains ONLY:
  - ‚úÖ Tab system / Navigation
  - ‚úÖ Component imports
  - ‚úÖ General layout (max 200-400 lines)
- ‚ùå NO business logic
- ‚ùå NO extended form markup

#### 2Ô∏è‚É£ COMPONENTS = LOGIC + COMPLETE UI

- Each component in `src/components/[Feature]/`
- Self-contained (300-800 lines)
- Well-defined Props/Emits

#### 3Ô∏è‚É£ ARCHITECTURE BENEFITS

- ‚úÖ **Maintainability:** Small files (200-800 lines)
- ‚úÖ **Reusability:** Standalone components
- ‚úÖ **Testing:** Simple unit tests
- ‚úÖ **Performance:** Lazy loading
- ‚úÖ **Team Collaboration:** No Git conflicts

### Vue 3 Component Template

```vue
<script setup lang="ts">
/**
 * @file ComponentName.vue
 * @description Component purpose and functionality
 * @author Vasile Chifeac
 * @created 2025-12-10
 * @modified 2025-12-10
 *
 * @example
 * <ComponentName :prop="value" @event="handler" />
 *
 * @notes
 * - Important implementation details
 * - Known limitations
 * - Dependencies
 */

// ============================================================
// IMPORTS
// ============================================================
import { ref, computed, watch, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useSecureLogger } from 'src/composables/useSecureLogger';
import { useSmartEnvironment } from 'src/composables/useSmartEnvironment';
import type { SomeType } from 'src/types/SomeTypes';

// ============================================================
// COMPOSABLES
// ============================================================
const logger = useSecureLogger('ComponentName');
const { isDevelopment } = useSmartEnvironment();
const router = useRouter();

// ============================================================
// PROPS & EMITS
// ============================================================
interface Props {
  /** Prop description with constraints */
  someProp: string;
  /** Optional prop with default */
  optionalProp?: number;
}

const props = withDefaults(defineProps<Props>(), {
  optionalProp: 0,
});

interface Emits {
  /** Event description with payload type */
  (event: 'someEvent', payload: string): void;
}

const emit = defineEmits<Emits>();

// ============================================================
// STATE
// ============================================================
/** State variable description */
const someState = ref<string>('');
const isLoading = ref(false);

// ============================================================
// COMPUTED
// ============================================================
/**
 * Computed description
 * @returns Description of return value
 */
const someComputed = computed(() => {
  return someState.value.toUpperCase();
});

// ============================================================
// WATCHERS
// ============================================================
watch(someState, (newValue, oldValue) => {
  logger.debug('State changed', { from: oldValue, to: newValue });
});

// ============================================================
// FUNCTIONS
// ============================================================
/**
 * Function description
 * @param param - Parameter description
 */
const someFunction = (param: string): void => {
  logger.info('Function called', { param });
};

/**
 * Async function with error handling
 */
const asyncFunction = async (): Promise<void> => {
  try {
    isLoading.value = true;
    // Implementation
    logger.info('Async operation completed');
  } catch (error) {
    logger.error('Async operation failed', { error });
  } finally {
    isLoading.value = false;
  }
};

// ============================================================
// LIFECYCLE
// ============================================================
onMounted(() => {
  logger.debug('Component mounted');
  void asyncFunction();
});
</script>

<template>
  <div class="component-container">
    <!-- Template content -->
  </div>
</template>

<style scoped lang="scss">
.component-container {
  padding: 16px;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .component-container {
    padding: 8px;
  }
}
</style>
```

---

## üìö DOCUMENTATION STANDARDS

### JSDoc Requirements

**ALL public functions MUST have JSDoc:**

```typescript
/**
 * Calculate Body Mass Index (BMI) for patient
 *
 * BMI is calculated as weight (kg) / height¬≤ (m¬≤). Used for obesity screening
 * and cardiovascular risk assessment per WHO guidelines.
 *
 * @param weight - Patient weight in kilograms (range: 20-300 kg)
 * @param height - Patient height in meters (range: 0.5-2.5 m)
 * @returns BMI value rounded to 1 decimal place
 * @throws {ValidationError} If weight or height outside valid range
 *
 * @example
 * const bmi = calculateBMI(75, 1.75); // Returns 24.5
 *
 * @see {@link https://www.who.int/publications/i/item/9789241501491 | WHO BMI Classification}
 */
export function calculateBMI(weight: number, height: number): number {
  // Validation
  if (weight < 20 || weight > 300) {
    throw new ValidationError('Weight must be between 20-300 kg');
  }
  if (height < 0.5 || height > 2.5) {
    throw new ValidationError('Height must be between 0.5-2.5 m');
  }

  // Calculation
  const bmi = weight / (height * height);

  // Return with precision
  return Math.round(bmi * 10) / 10;
}
```

**Required JSDoc Elements:**

- `@param` - Each parameter with description + range/constraints
- `@returns` - What function returns
- `@throws` - Possible exceptions
- `@example` - Concrete usage example
- `@see` - Link to external documentation (optional but recommended)

---

## ü©∫ MEDICAL CALCULATOR DOCUMENTATION

### 9 Mandatory Sections

**EVERY medical calculator MUST include:**

1. **Clinical Definition** - What is measured, clinical significance
2. **Physiology** - Underlying mechanisms, pathophysiology
3. **Measurement Method** - How to obtain required values
4. **Formula** - Mathematical calculation with units
5. **Interpretation** - How to read results, clinical meaning
6. **Clinical Applications** - When to use, decision support
7. **Reference Values** - Normal ranges, cutoffs
8. **Documentation** - Standardized protocols (e.g., WHO, AHA)
9. **Scientific References** - Minimum 3 peer-reviewed sources with DOI

### Example Structure

```vue
<q-expansion-item label="Clinical Definition">
  <q-card>
    <div class="text-body2">
      <strong>What is [Parameter]:</strong>
      [Clear definition in layman terms]
    </div>
    <div class="text-body2 q-mt-md">
      <strong>Clinical Significance:</strong>
      [Why it matters, what it indicates]
    </div>
  </q-card>
</q-expansion-item>

<q-expansion-item label="Physiology">
  <q-card>
    <div class="text-body2">
      <strong>Normal Physiology:</strong>
      [How system works normally]
    </div>
    <div class="text-body2 q-mt-md">
      <strong>Pathophysiology:</strong>
      [What goes wrong in disease]
    </div>
  </q-card>
</q-expansion-item>

<!-- ... 7 more sections ... -->

<q-expansion-item label="Scientific References">
  <q-card>
    <q-list>
      <q-item>
        <q-item-section>
          <q-item-label>
            Author et al. (Year). Title. <em>Journal</em>, Volume(Issue), Pages.
          </q-item-label>
          <q-item-label caption>
            DOI: <a href="https://doi.org/xxx">10.xxxx/xxxxx</a>
          </q-item-label>
          <q-item-label caption>
            <a href="https://www.sciencedirect.com/...">ScienceDirect</a>
          </q-item-label>
        </q-item-section>
      </q-item>
    </q-list>
  </q-card>
</q-expansion-item>
```

### Medical Content Requirements

- ‚úÖ Professional medical/scientific tone
- ‚úÖ Concise descriptions (avoid excessive length)
- ‚úÖ Verified sources: ScienceDirect, MSD Manuals, PubMed
- ‚úÖ NO emoji in clinical text (only in UI labels)
- ‚úÖ Bilingual support (Italian/English)

---

## üåç INTERNATIONALIZATION (i18n)

### Bilingual Structure

**ALL medical calculators must support IT/EN:**

```typescript
// src/i18n/en-US/mechanicalPower.ts
export default {
  title: 'Mechanical Power Calculator',
  clinicalDefinition: {
    title: 'Clinical Definition',
    description: 'Mechanical Power represents the energy...',
  },
  // ...
};

// src/i18n/it-IT/mechanicalPower.ts
export default {
  title: 'Calcolatore Potenza Meccanica',
  clinicalDefinition: {
    title: 'Definizione Clinica',
    description: "La Potenza Meccanica rappresenta l'energia...",
  },
  // ...
};
```

**Usage in Components:**

```vue
<script setup lang="ts">
import { useI18n } from 'vue-i18n';

const { t } = useI18n();
</script>

<template>
  <q-expansion-item :label="t('mechanicalPower.clinicalDefinition.title')">
    <q-card>
      <div class="text-body2">{{ t('mechanicalPower.clinicalDefinition.description') }}</div>
    </q-card>
  </q-expansion-item>
</template>
```

---

## üß™ TESTING STANDARDS

### Test Coverage Targets

- ‚úÖ **Critical Logic:** 90%+ coverage
- ‚úÖ **Business Logic:** 80%+ coverage
- ‚úÖ **UI Components:** 60%+ coverage
- ‚úÖ **Utilities:** 100% coverage

### Test Structure

```typescript
/**
 * Test suite for BMI Calculator
 */
import { describe, it, expect, beforeEach } from 'vitest';
import { calculateBMI } from 'src/utils/calculators';

describe('calculateBMI', () => {
  it('should calculate BMI correctly', () => {
    // Arrange
    const weight = 75;
    const height = 1.75;

    // Act
    const result = calculateBMI(weight, height);

    // Assert
    expect(result).toBe(24.5);
  });

  it('should throw error for invalid weight', () => {
    // Arrange
    const weight = 500; // Invalid
    const height = 1.75;

    // Act & Assert
    expect(() => calculateBMI(weight, height)).toThrow('Weight must be between 20-300 kg');
  });
});
```

---

## üîê SECURITY BEST PRACTICES

### Input Validation

```typescript
// ‚úÖ CORRECT - Complete validation
function processUserInput(input: string): string {
  // 1. Sanitize HTML
  const sanitized = input
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');

  // 2. Length check
  if (sanitized.length > 1000) {
    throw new ValidationError('Input too long');
  }

  // 3. Pattern validation
  if (!/^[a-zA-Z0-9\s.,!?-]+$/.test(sanitized)) {
    throw new ValidationError('Invalid characters detected');
  }

  return sanitized;
}

// ‚ùå WRONG - No validation
function processUserInput(input: string): string {
  return input; // XSS vulnerability!
}
```

### Secrets Management

```typescript
// ‚úÖ CORRECT - Environment variables
const API_KEY = import.meta.env.VITE_API_KEY;
const DB_URL = import.meta.env.VITE_DATABASE_URL;

if (!API_KEY) {
  throw new Error('Missing VITE_API_KEY environment variable');
}

// ‚ùå WRONG - Hardcoded secrets
const API_KEY = 'sk-1234567890abcdef'; // NEVER DO THIS!
```

### Error Handling

```typescript
// ‚úÖ CORRECT - Safe error handling
try {
  await sensitiveOperation();
} catch (error) {
  // Log error without exposing details
  logger.error('Operation failed', { operation: 'sensitiveOperation' });
  // Show generic message to user
  throw new Error('Operation failed. Please try again.');
}

// ‚ùå WRONG - Exposes stack trace
try {
  await sensitiveOperation();
} catch (error) {
  // Exposes internal details!
  alert(`Error: ${error.message}\n${error.stack}`);
}
```

---

## üì¶ GIT COMMIT STANDARDS

### Conventional Commits Format

```bash
# ‚úÖ CORRECT - Conventional Commits
feat(calculator): add mechanical power calculator with VILI risk assessment
fix(api): handle 404 error in getUserById
docs(readme): update installation instructions
style(button): fix button padding inconsistency
refactor(auth): simplify login logic
test(bmi): add edge case tests for BMI calculator
chore(deps): update Vue to 3.4.0

# ‚ùå WRONG - Generic commit messages
git commit -m "fix"
git commit -m "update"
git commit -m "changes"
```

**Format:** `<type>(<scope>): <description>`

**Types:**

- `feat` - New feature
- `fix` - Bug fix
- `docs` - Documentation
- `style` - Code style (formatting, no logic change)
- `refactor` - Code refactoring
- `test` - Tests
- `chore` - Build, dependencies, tools

---

## üìû PROJECT INFORMATION

### Repository

- **Name**: medicalUtilityApp
- **Owner**: vas-chif
- **Branch**: main (protected)
- **URL**: https://github.com/vas-chif/medicalUtilityApp

### Environment

- **Development**: `yarn dev` (http://localhost:9000)
- **Production**: Vercel/Firebase deployment
- **Testing**: `yarn test:unit` (Vitest)

### Support Resources

- **Documentation**: `/docs` folder
- **Templates**: `COPILOT_RULES_TEMPLATE.md`, `CODING_STANDARDS_TEMPLATE.md`
- **Medical Standards**: `.rules-copilot-medical.md` (this file)

---

## ‚úÖ COMPLIANCE CHECKLIST

Before committing code, verify:

- ‚úÖ TypeScript strict mode passes (`yarn type-check`)
- ‚úÖ ESLint passes (`yarn lint`)
- ‚úÖ All tests pass (`yarn test:unit`)
- ‚úÖ useSecureLogger used (NO console.log)
- ‚úÖ useSmartEnvironment for env detection
- ‚úÖ JSDoc for all public functions
- ‚úÖ Medical content has 9 sections + references
- ‚úÖ Bilingual support (IT/EN) implemented
- ‚úÖ Input validation complete
- ‚úÖ No hardcoded secrets
- ‚úÖ Commit message follows Conventional Commits

---

**VERSION HISTORY:**

- v2.0 (2025-12-10) - Consolidated from REGOLE_COPILOT.md, CODING_STANDARDS.md, templates
- v1.0 (2025-11-17) - Initial version

**NEXT REVIEW:** 2026-01-10
