<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drug Compatibility Data Entry Tool - San Gerardo Hospital</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 30px;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 2rem;
    }
    
    .subtitle {
      color: #7f8c8d;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    
    .legend {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 30px;
      border-radius: 8px;
    }
    
    .legend-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .legend-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      flex-shrink: 0;
    }
    
    .color-compatible { background: #27ae60; }
    .color-y-site { background: #f39c12; }
    .color-incompatible { background: #e74c3c; }
    .color-conflicting { background: #e67e22; }
    .color-cvc { background: #95e1d3; }
    .color-no-data { background: #bdc3c7; }
    
    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      font-weight: 600;
      color: #34495e;
      font-size: 0.9rem;
    }
    
    input, select, textarea {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .compatibility-matrix {
      margin-top: 30px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      background: #f8f9fa;
    }
    
    .matrix-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 15px;
    }
    
    .matrix-row {
      display: grid;
      grid-template-columns: 200px repeat(6, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }
    
    .matrix-drug-name {
      font-weight: 600;
      color: #34495e;
      padding: 8px;
      background: white;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    
    .matrix-select {
      padding: 8px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      background: white;
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: #95a5a6;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #7f8c8d;
    }
    
    .btn-success {
      background: #27ae60;
      color: white;
    }
    
    .btn-success:hover {
      background: #229954;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .drug-list {
      margin-top: 30px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      background: #f8f9fa;
    }
    
    .drug-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .drug-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .drug-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .drug-category {
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .drug-details {
      color: #7f8c8d;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .output-area {
      margin-top: 30px;
      border: 2px solid #27ae60;
      border-radius: 8px;
      padding: 20px;
      background: #f8fff9;
      display: none;
    }
    
    .output-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #27ae60;
      margin-bottom: 15px;
    }
    
    .output-code {
      background: #2c3e50;
      color: #27ae60;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      overflow-x: auto;
      white-space: pre;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .copy-btn {
      background: #27ae60;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .copy-btn:hover {
      background: #229954;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .stat-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
    }
    
    .stat-label {
      color: #7f8c8d;
      font-size: 0.85rem;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè• Drug Compatibility Data Entry Tool</h1>
    <div class="subtitle">
      San Gerardo Hospital - Monza | Universit√† degli Studi di Milano-Bicocca<br>
      Authors: Daniele Moretta, Alessia Gazzola, Stefania Podda≈ü, Alberto Lucchini
    </div>
    
    <!-- LEGEND -->
    <div class="legend">
      <div class="legend-title">üìã Legenda Compatibilit√†</div>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-color color-compatible"></div>
          <span><strong>C</strong> - Compatible (Verde)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color color-y-site"></div>
          <span><strong>Y</strong> - Y-site only (Giallo)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color color-incompatible"></div>
          <span><strong>I</strong> - Incompatible (Rosso)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color color-conflicting"></div>
          <span><strong>!</strong> - Conflicting Data (Arancione)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color color-cvc"></div>
          <span><strong>si</strong> - CVC necessario (Verde chiaro)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color color-no-data"></div>
          <span><strong>''</strong> - No Data (Grigio)</span>
        </div>
      </div>
    </div>
    
    <!-- DRUG INPUT FORM -->
    <div class="input-section">
      <div class="input-group">
        <label for="drugName">Nome Farmaco *</label>
        <input type="text" id="drugName" placeholder="es. Amiodarone" required>
      </div>
      
      <div class="input-group">
        <label for="activeIngredient">Principio Attivo</label>
        <input type="text" id="activeIngredient" placeholder="es. Amiodarone Hydrochloride">
      </div>
      
      <div class="input-group">
        <label for="category">Categoria</label>
        <select id="category">
          <option value="antibiotic">Antibiotic</option>
          <option value="analgesic">Analgesic</option>
          <option value="cardiovascular">Cardiovascular</option>
          <option value="anticoagulant">Anticoagulant</option>
          <option value="sedative">Sedative</option>
          <option value="electrolyte">Electrolyte</option>
          <option value="vasopressor">Vasopressor</option>
          <option value="insulin">Insulin</option>
          <option value="diuretic">Diuretic</option>
          <option value="antiarrhythmic">Antiarrhythmic</option>
          <option value="other">Other</option>
        </select>
      </div>
      
      <div class="input-group">
        <label for="concentration">Concentrazione</label>
        <input type="text" id="concentration" placeholder="es. > 2mg/ml CVC+">
      </div>
      
      <div class="input-group">
        <label for="clinicalNotes">Note Cliniche</label>
        <textarea id="clinicalNotes" placeholder="es. Class III antiarrhythmic - Requires CVC for high concentrations"></textarea>
      </div>
    </div>
    
    <!-- CHECKBOXES -->
    <div class="checkbox-group">
      <input type="checkbox" id="requiresCVC">
      <label for="requiresCVC">Richiede CVC (Central Venous Catheter)</label>
    </div>
    
    <div class="checkbox-group">
      <input type="checkbox" id="lightSensitive">
      <label for="lightSensitive">Fotosensibile (Conservare al riparo dalla luce)</label>
    </div>
    
    <!-- BUTTONS -->
    <div class="button-group">
      <button class="btn btn-primary" onclick="addDrug()">‚ûï Aggiungi Farmaco</button>
      <button class="btn btn-secondary" onclick="clearForm()">üîÑ Pulisci Form</button>
      <button class="btn btn-success" onclick="generateTypeScriptCode()">üì¶ Genera Codice TypeScript</button>
      <button class="btn btn-success" onclick="downloadJSON()">üíæ Scarica JSON</button>
    </div>
    
    <!-- STATS -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="drugCount">0</div>
        <div class="stat-label">Farmaci Inseriti</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="compatibilityCount">0</div>
        <div class="stat-label">Compatibilit√† Definite</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="cvcCount">0</div>
        <div class="stat-label">Farmaci con CVC</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="lightCount">0</div>
        <div class="stat-label">Farmaci Fotosensibili</div>
      </div>
    </div>
    
    <!-- DRUG LIST -->
    <div class="drug-list">
      <div class="matrix-title">üìù Farmaci Inseriti</div>
      <div id="drugListContainer">
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">Nessun farmaco inserito. Aggiungi il primo farmaco!</p>
      </div>
    </div>
    
    <!-- OUTPUT -->
    <div class="output-area" id="outputArea">
      <div class="output-title">‚úÖ Codice TypeScript Generato</div>
      <div class="output-code" id="outputCode"></div>
      <button class="copy-btn" onclick="copyCode()">üìã Copia Codice</button>
    </div>
  </div>
  
  <script>
    // Global state
    let drugs = [];
    let compatibilityMatrix = {};
    
    // Add drug
    function addDrug() {
      const name = document.getElementById('drugName').value.trim();
      if (!name) {
        alert('Nome farmaco obbligatorio!');
        return;
      }
      
      const drug = {
        id: name.toLowerCase().replace(/\s+/g, '-'),
        name: name,
        activeIngredient: document.getElementById('activeIngredient').value.trim(),
        category: document.getElementById('category').value,
        concentration: document.getElementById('concentration').value.trim(),
        route: 'intravenous',
        requiresCVC: document.getElementById('requiresCVC').checked,
        lightSensitive: document.getElementById('lightSensitive').checked,
        clinicalNotes: document.getElementById('clinicalNotes').value.trim(),
      };
      
      drugs.push(drug);
      updateStats();
      renderDrugList();
      clearForm();
      
      alert(`‚úÖ Farmaco "${name}" aggiunto con successo!`);
    }
    
    // Clear form
    function clearForm() {
      document.getElementById('drugName').value = '';
      document.getElementById('activeIngredient').value = '';
      document.getElementById('concentration').value = '';
      document.getElementById('clinicalNotes').value = '';
      document.getElementById('requiresCVC').checked = false;
      document.getElementById('lightSensitive').checked = false;
    }
    
    // Update statistics
    function updateStats() {
      document.getElementById('drugCount').textContent = drugs.length;
      document.getElementById('cvcCount').textContent = drugs.filter(d => d.requiresCVC).length;
      document.getElementById('lightCount').textContent = drugs.filter(d => d.lightSensitive).length;
      
      let compatCount = 0;
      for (const drug in compatibilityMatrix) {
        compatCount += Object.keys(compatibilityMatrix[drug] || {}).length;
      }
      document.getElementById('compatibilityCount').textContent = compatCount;
    }
    
    // Render drug list
    function renderDrugList() {
      const container = document.getElementById('drugListContainer');
      
      if (drugs.length === 0) {
        container.innerHTML = '<p style="color: #7f8c8d; text-align: center; padding: 20px;">Nessun farmaco inserito.</p>';
        return;
      }
      
      container.innerHTML = drugs.map(drug => `
        <div class="drug-card">
          <div class="drug-card-header">
            <div class="drug-name">${drug.name}</div>
            <div class="drug-category">${drug.category}</div>
          </div>
          <div class="drug-details">
            <strong>Principio Attivo:</strong> ${drug.activeIngredient || 'N/D'}<br>
            <strong>Concentrazione:</strong> ${drug.concentration || 'N/D'}<br>
            <strong>CVC:</strong> ${drug.requiresCVC ? '‚úÖ Richiesto' : '‚ùå Non richiesto'}<br>
            <strong>Fotosensibile:</strong> ${drug.lightSensitive ? '‚úÖ S√¨' : '‚ùå No'}<br>
            <strong>Note:</strong> ${drug.clinicalNotes || 'Nessuna nota'}
          </div>
        </div>
      `).join('');
    }
    
    // Generate TypeScript code
    function generateTypeScriptCode() {
      if (drugs.length === 0) {
        alert('Nessun farmaco da generare!');
        return;
      }
      
      const drugsCode = drugs.map(drug => `  {
    id: '${drug.id}',
    name: '${drug.name}',
    activeIngredient: '${drug.activeIngredient}',
    category: '${drug.category}' as DrugCategory,
    concentration: '${drug.concentration}',
    route: 'intravenous' as AdministrationRoute,${drug.requiresCVC ? '\n    requiresCVC: true,' : ''}${drug.lightSensitive ? '\n    lightSensitive: true,' : ''}
    clinicalNotes: '${drug.clinicalNotes}',
  }`).join(',\n');
      
      const code = `// Generated on ${new Date().toLocaleString('it-IT')}
// Total drugs: ${drugs.length}

export const drugsDatabase: Drug[] = [
${drugsCode}
];

export const compatibilityMatrix: CompatibilityMatrix = {
  // TODO: Add compatibility data from San Gerardo Hospital table images
};`;
      
      document.getElementById('outputCode').textContent = code;
      document.getElementById('outputArea').style.display = 'block';
      document.getElementById('outputArea').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Copy code to clipboard
    function copyCode() {
      const code = document.getElementById('outputCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        alert('‚úÖ Codice copiato negli appunti!');
      });
    }
    
    // Download JSON
    function downloadJSON() {
      if (drugs.length === 0) {
        alert('Nessun farmaco da scaricare!');
        return;
      }
      
      const data = {
        version: '1.0.0',
        lastUpdate: new Date().toISOString().split('T')[0],
        description: 'Drug compatibility database - San Gerardo Hospital',
        drugs: drugs,
        compatibilityMatrix: compatibilityMatrix,
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `drug-database-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
